---
title: "RD2 - TP ACP"
output:
  pdf_document: default
  html_notebook: default
---
Utiliser le document STHDA sur l'acp en ligne.

# Exercice I: exemple "Budget-Temps-ONU" 

Il s'agit d'une enquête (ONU 1967) sur les budgets-temps (temps passé dans différentes activités au cours de la journée).Le tableau suivant comprend 10 variables numériques et 4 variables catégorisées. Les 10 variables numériques sont: le temps passé en: Profession, Transport, Ménage, Enfants, Courses, Toilette, Repas, Sommeil, Télé, Loisirs.

Les 4 variables catégorisées sont: Le sexe (1=Hommes 2=Femmes), l’activité (1=Actifs 2=Non Act. 9=Non précisé), l’état civil (1=Célibataires 2=Mariés 9=Non précisé), le Pays  (1=USA 2=Pays de l'Ouest 3=Pays de l'Est 4=Yougoslavie).

 Le code suivant est utilisé pour identifier les lignes: H: Hommes, F: Femmes, A: Actifs, N: Non Actifs(ves), M: Mariés, C: Célibataires, U: USA, W: Pays de l'Ouest sauf USA, E : Est sauf Yougoslavie, Y: Yougoslavie

 Les temps sont notés en centièmes d'heures. La première case en haut à gauche du  tableau (HAU) indique que les Hommes Actifs des USA passent en moyenne 6 heures et 6 minutes (6 heures + 10/100 d'heure, soit 6 heures et 6mn) en activité PROFessionnelle. Le total d'une ligne (sur ces 10 variables numériques) est 2400 (24 heures).
```{r include=FALSE}
ONU=read.table('ONU.csv',sep=',',h=T)
for (i in 11:14) ONU[,i]=as.factor(ONU[,i])
summary(ONU)
library(FactoMineR);library(factoextra);library("corrplot")
```

Pour répondre aux questions, créer un notebook ou un document oo dans lequel vous conserverez les sorties ainsi que vos commentaires. 

0. A quoi sert la ligne 2 de commande? Etudier la matrice des corrélations et conjecturer les axes factorielles et leurs inerties respectives. On pourra utiliser les commandes cor, corrplot ...
```{r}
round(cor(ONU[,1:10]),2)
corrplot(cor(ONU[,1:10]))

```
1. Réaliser l'ACP normé de ce tableau, en utilisant les variables qualitatives en supplémentaire.
```{r}
acp=PCA(ONU,quali.sup=11:14)
```

2. Déterminer les axes retenus pour l'analyse en justifiant votre choix. Quelle est la qualité de l'ACP dans le plan F1-F2. On pourra utiliser les commandes fviz_eig, acp$eig, barplot...
```{r}
acp$eig
fviz_eig(acp,addlabels = TRUE)

```
3. Représenter les variables dans le plan F1 - F2. Quelles sont les variables bien représentées dans le plan 1-2?  Quelles sont le variables les plus corrélées entre elles et avec les axes factoriels? les moins corrélées ? On pourra utiliser les commandes $var, fviz_contrib, plot.PCA ...
```{r}
plot.PCA(acp,choix="var",axes=c(1,2))

fviz_contrib(acp,choice = "var")
#plot.PCA(acp)
```

4. Représenter les individus dans le plan 1-2 en ne retenant que ceux dont le cos2 est satisfaisant. Quelle est l'individu le mieux représenté.
```{r}
plot.PCA(acp,choix="ind",select="cos2 0.5 ")
corrplot(acp$ind$contrib, is.corr=FALSE)
fviz_contrib(acp,choice = "ind", axes=2)
plot.PCA(acp,choix="ind",select="contrib 10")
```

5. Pour chaque axe retenu, quelles sont les variables et individus ayant le plus contribué. On utilisera des graphiques pour justifier le résultat.
```{r}
fviz_contrib(acp, choice = "ind", axes = c(1,2))
fviz_contrib(acp, choice = "var", axes = c(1,2))

```

6. Représenter les variables qualitatives. Interpréter le résultat et le test leur correspondant.
```{r}
fviz_pca_ind (acp,habillage=11,addEllipses = TRUE)
fviz_pca_ind (acp,habillage=12,addEllipses = TRUE)
fviz_pca_ind (acp,habillage=13,addEllipses = TRUE)
fviz_pca_ind (acp,habillage=14,addEllipses = TRUE)
```
7. Réaliser une classification des individus et des variables à l'aide de les fonctions HCPC, kmeans, fviz_cluster.

```{r}
HCPC(acp, nb.clust=4)

```


8. Proposer une interprétation des résultats. 

# Exercice II: Reprendre l'ACP sur le fichier csp.txt
Le tableau des données indique les dépenses annuelles moyennes de consommation
de douze catégories socio-professionnelles. Les douze individus du tableau, qui sont ici présentés
en ligne, désignent des catégories socio-professionnelles caractérisées par la CSP variable
qualitative à trois modalités (1 = manoeuvre, 2 = employé et 3 = cadre) et le nombre de personnes dans le foyer
(2, 3, 4 ou 5). Par exemple, l’individu MA2 désigne la catégorie "manoeuvre avec aucun",
EM2 la catégorie "employé avec deux enfants", CA5 la catégorie "cadre avec trois enfants", etc.
Les sept premières variables, qui sont présentées ici en colonne, sont les variables actives. Ces
variables désignent respectivement les dépenses annuelles moyennes de consommation en pain,
légumes, fruits, viande, volaille, lait et vin. On effectue l’ACP normée (ACPN) de ce tableau en
considérant comme supplémentaires les variables "csp" et "nb". 

1. Commenter brièvement le tableau des statistiques sommaires.
```{r}
csp=read.table("csp2.txt",h=T)
csp$nb=as.factor(csp$nb)
summary(csp)
csp
```


2. Que peut-on dire des corrélations entre variables ?

```{r}
round(cor(csp[,1:7]),2)
```

3. Que vaut l’inertie totale dans l’ACP normée effectuée et la contribution relative de chaque variable à l’inertie totale?

```{r}
acp2=PCA(csp,quali.sup=8:9)
```

5. Combien d’axes factoriels pensez-vous qu’il faille retenir ?

```{r}
fviz_eig(acp2,addlabels = TRUE)
```

6. Calculer la contribution  de chaque variable  au a ème facteur (a = 1, 2).
```{r}
fviz_contrib(acp2,choice = "var")
fviz_contrib(acp2,choice = "var", axes=2)
```


7. Calculer le carré de la corrélation CORa(i) de chaque variable  avec le a ème facteur (a = 1, 2),

```{r}
acp2$var$cos2
```

puis la qualité de la représentation associée QLT2(i) dans le plan factoriel 1  2.
```{r}
acp2$var$cos2 -acp2$var$coord **2
```


8. Quel est l’intérêt de ranger les variables par corrélation décroissante avec le premier facteur
(ou première composante principale) pour examiner la matrice de corrélation ?

```{r}
acp2$eig
```

9. Quelles sont les variables caractéristiques du premier axe factoriel ?
10. Quelles sont les variables caractéristiques du deuxième axe factoriel ?
11. Interpréter le cercle des corrélations.
12. Quelles sont les observations caractéristiques du premier axe factoriel (on se basera sur les
contributions de chaque observation i au premier axe factoriel).
13. Donner la qualité de représentation de chaque observation i sur le plan des deux premiers
axes factoriels.
14. Quelles sont les observations caractéristiques du deuxième axe factoriel ?
15. Interpréter le plan des deux premiers axes factoriels (on aura intérêt à joindre tous les points
associés à une famille ayant le même nombre d’enfants et, de même, tous les points associés à
une même CSP).